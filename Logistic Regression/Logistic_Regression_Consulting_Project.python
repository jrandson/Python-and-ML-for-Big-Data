{"version":"NotebookV1","origId":3632859077492018,"name":"Logistic_Regression_Consulting_Project","language":"python","commands":[{"version":"CommandV1","origId":284330860034167,"guid":"581537b0-458e-4447-9cec-649b98e289b2","subtype":"command","commandType":"auto","position":13.0,"command":"from pyspark.ml.evaluation import BinaryClassificationEvaluator","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1515947993996,"submitTime":1515947993979,"finishTime":1515947994022,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5bac5f09-1337-4058-a821-4a4a89f3d113"},{"version":"CommandV1","origId":284330860034169,"guid":"972554ea-6d10-4ef3-acf0-075d22072fbd","subtype":"command","commandType":"auto","position":14.0,"command":"eval_obj = BinaryClassificationEvaluator(rawPredictionCol='prediction', labelCol='Churn')","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1515947998053,"submitTime":1515947998035,"finishTime":1515947998126,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9873531c-801d-4071-bc7d-47ac009affdd"},{"version":"CommandV1","origId":284330860034170,"guid":"316d5c56-2065-4c1b-b198-67c8a4be36b9","subtype":"command","commandType":"auto","position":15.0,"command":"auc = eval_obj.evaluate(predictions_and_labels.predictions)\nprint auc\n\npredictions_and_labels.predictions.select('prediction','Churn').show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">0.738532110092\n+----------+-----+\n|prediction|Churn|\n+----------+-----+\n|       0.0|    0|\n|       0.0|    1|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    1|\n|       0.0|    0|\n|       0.0|    1|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    1|\n|       0.0|    0|\n|       0.0|    0|\n|       0.0|    0|\n+----------+-----+\nonly showing top 20 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;BinaryLogisticRegressionSummary&apos; object has no attribute &apos;_jdf&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-284330860034170&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>auc <span class=\"ansiyellow\">=</span> eval_obj<span class=\"ansiyellow\">.</span>evaluate<span class=\"ansiyellow\">(</span>predictions_and_labels<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansigreen\">print</span> auc<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> predictions_and_labels<span class=\"ansiyellow\">.</span>predictions<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;prediction&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;Churn&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/ml/evaluation.py</span> in <span class=\"ansicyan\">evaluate</span><span class=\"ansiblue\">(self, dataset, params)</span>\n<span class=\"ansigreen\">     67</span>                 <span class=\"ansigreen\">return</span> self<span class=\"ansiyellow\">.</span>copy<span class=\"ansiyellow\">(</span>params<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>_evaluate<span class=\"ansiyellow\">(</span>dataset<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     68</span>             <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 69</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">return</span> self<span class=\"ansiyellow\">.</span>_evaluate<span class=\"ansiyellow\">(</span>dataset<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     70</span>         <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     71</span>             <span class=\"ansigreen\">raise</span> ValueError<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;Params must be a param map but got %s.&quot;</span> <span class=\"ansiyellow\">%</span> type<span class=\"ansiyellow\">(</span>params<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/ml/evaluation.py</span> in <span class=\"ansicyan\">_evaluate</span><span class=\"ansiblue\">(self, dataset)</span>\n<span class=\"ansigreen\">     97</span>         &quot;&quot;&quot;\n<span class=\"ansigreen\">     98</span>         self<span class=\"ansiyellow\">.</span>_transfer_params_to_java<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 99</span><span class=\"ansiyellow\">         </span><span class=\"ansigreen\">return</span> self<span class=\"ansiyellow\">.</span>_java_obj<span class=\"ansiyellow\">.</span>evaluate<span class=\"ansiyellow\">(</span>dataset<span class=\"ansiyellow\">.</span>_jdf<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    100</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    101</span>     <span class=\"ansigreen\">def</span> isLargerBetter<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;BinaryLogisticRegressionSummary&apos; object has no attribute &apos;_jdf&apos;</div>","workflows":[],"startTime":1515948071089,"submitTime":1515948071074,"finishTime":1515948071667,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"18aa49a9-fcce-4911-8fd7-a149b994f657"},{"version":"CommandV1","origId":284330860034171,"guid":"7df225e8-f7cd-4845-a0a3-c9130a38c420","subtype":"command","commandType":"auto","position":16.0,"command":"ROC = predictions_and_labels.areaUnderROC\nprint ROC","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">0.877558221595\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">TypeError</span>: &apos;BinaryClassificationEvaluator&apos; object is not callable","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">TypeError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-284330860034171&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> ROC <span class=\"ansiyellow\">=</span> predictions_and_labels<span class=\"ansiyellow\">.</span>areaUnderROC<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 2</span><span class=\"ansiyellow\"> </span>AUC <span class=\"ansiyellow\">=</span> eval_obj<span class=\"ansiyellow\">(</span>predictions_and_labels<span class=\"ansiyellow\">.</span>roc<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansigreen\">print</span> ROC<span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">TypeError</span>: &apos;BinaryClassificationEvaluator&apos; object is not callable</div>","workflows":[],"startTime":1515940920137,"submitTime":1515940920125,"finishTime":1515940920211,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"97548878-d8a2-4360-b202-9886e2da3859"},{"version":"CommandV1","origId":284330860034172,"guid":"86e590a6-5ad4-4fc9-8b0a-ca2af9afa961","subtype":"command","commandType":"auto","position":17.0,"command":"new_costumers = spark.read.format('csv').load('/FileStore/tables/new_customers.csv', header=True, inferSchema=True)\nnew_costumers.show()\n\ncolumns = new_costumers.columns\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+--------------+----+--------------+---------------+-----+---------+-------------------+--------------------+----------------+\n|         Names| Age|Total_Purchase|Account_Manager|Years|Num_Sites|       Onboard_date|            Location|         Company|\n+--------------+----+--------------+---------------+-----+---------+-------------------+--------------------+----------------+\n| Andrew Mccall|37.0|       9935.53|              1| 7.71|      8.0|2011-08-29 18:37:54|38612 Johnny Stra...|        King Ltd|\n|Michele Wright|23.0|       7526.94|              1| 9.28|     15.0|2013-07-22 18:19:54|21083 Nicole Junc...|   Cannon-Benson|\n|  Jeremy Chang|65.0|         100.0|              1|  1.0|     15.0|2006-12-11 07:48:13|085 Austin Views ...|Barron-Robertson|\n|Megan Ferguson|32.0|        6487.5|              0|  9.4|     14.0|2016-10-28 05:32:13|922 Wright Branch...|   Sexton-Golden|\n|  Taylor Young|32.0|      13147.71|              1| 10.0|      8.0|2012-03-20 00:36:46|Unit 0789 Box 073...|        Wood LLC|\n| Jessica Drake|22.0|       8445.26|              1| 3.46|     14.0|2011-02-04 19:29:27|1148 Tina Straven...|   Parks-Robbins|\n+--------------+----+--------------+---------------+-----+---------+-------------------+--------------------+----------------+\n\n6\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"new_costumers","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"Names","nullable":true,"type":"string"},{"metadata":{},"name":"Age","nullable":true,"type":"double"},{"metadata":{},"name":"Total_Purchase","nullable":true,"type":"double"},{"metadata":{},"name":"Account_Manager","nullable":true,"type":"integer"},{"metadata":{},"name":"Years","nullable":true,"type":"double"},{"metadata":{},"name":"Num_Sites","nullable":true,"type":"double"},{"metadata":{},"name":"Onboard_date","nullable":true,"type":"timestamp"},{"metadata":{},"name":"Location","nullable":true,"type":"string"},{"metadata":{},"name":"Company","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1515941139613,"submitTime":1515941139607,"finishTime":1515941140389,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"Predicting new costumers","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8745023f-4e61-4809-b193-ab4ad8e257f9"},{"version":"CommandV1","origId":284330860034173,"guid":"a13c2dbc-900d-4076-a39a-f76ae1690992","subtype":"command","commandType":"auto","position":11.5,"command":"predictions_and_labels.predictions.show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+--------------------+-----+--------------------+--------------------+----------+\n|            features|Churn|       rawPrediction|         probability|prediction|\n+--------------------+-----+--------------------+--------------------+----------+\n|[22.0,11254.38,1....|    0|[4.96243085823127...|[0.99305270151075...|       0.0|\n|[26.0,8787.39,1.0...|    1|[0.72096113624976...|[0.67281863069990...|       0.0|\n|[28.0,8670.98,0.0...|    0|[8.46969639090368...|[0.99979031540765...|       0.0|\n|[29.0,5900.78,1.0...|    0|[4.74528341012364...|[0.99138231201175...|       0.0|\n|[29.0,10203.18,1....|    0|[4.19478717739328...|[0.98514989947759...|       0.0|\n|[29.0,11274.46,1....|    0|[4.86838991640167...|[0.99237288990989...|       0.0|\n|[29.0,13255.05,1....|    0|[4.42532879550177...|[0.98817131769747...|       0.0|\n|[30.0,8874.83,0.0...|    0|[3.46858435213054...|[0.96978055879636...|       0.0|\n|[30.0,10744.14,1....|    1|[2.00960550154544...|[0.88180191087435...|       0.0|\n|[30.0,10960.52,1....|    0|[2.65792347794385...|[0.93449767360481...|       0.0|\n|[30.0,11575.37,1....|    1|[4.34442607648195...|[0.98718733990118...|       0.0|\n|[30.0,13473.35,0....|    0|[2.66146293407031...|[0.93471399707836...|       0.0|\n|[31.0,7073.61,0.0...|    0|[3.48830206669816...|[0.97035308871373...|       0.0|\n|[31.0,10058.87,1....|    0|[5.02853980699898...|[0.99349423664582...|       0.0|\n|[31.0,10182.6,1.0...|    0|[5.22840542205861...|[0.99466652970846...|       0.0|\n|[32.0,8011.38,0.0...|    0|[2.22420580771163...|[0.90240223885835...|       0.0|\n|[32.0,9885.12,1.0...|    1|[2.11361908486605...|[0.89221985175718...|       0.0|\n|[32.0,11715.72,0....|    0|[3.55257591351468...|[0.97214725903083...|       0.0|\n|[32.0,12142.99,0....|    0|[6.02044483098412...|[0.99757729471245...|       0.0|\n|[32.0,12479.72,0....|    0|[4.84607772699151...|[0.99220214160452...|       0.0|\n+--------------------+-----+--------------------+--------------------+----------+\nonly showing top 20 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;BinaryLogisticRegressionSummary&apos; object has no attribute &apos;show&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-284330860034173&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>predictions_and_labels<span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;BinaryLogisticRegressionSummary&apos; object has no attribute &apos;show&apos;</div>","workflows":[],"startTime":1515947992426,"submitTime":1515947992408,"finishTime":1515947992904,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"393411a6-bba6-4d4f-878c-acc69a40e9ee"},{"version":"CommandV1","origId":284330860034174,"guid":"95713a31-f32f-4e09-95b1-665e9990898e","subtype":"command","commandType":"auto","position":18.0,"command":"new_data = assembler.transform(new_costumers[features_col])\nresult = lr_model.transform(new_data)\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"new_data","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"Age","nullable":true,"type":"double"},{"metadata":{},"name":"Total_Purchase","nullable":true,"type":"double"},{"metadata":{},"name":"Account_Manager","nullable":true,"type":"integer"},{"metadata":{},"name":"Years","nullable":true,"type":"double"},{"metadata":{},"name":"Num_Sites","nullable":true,"type":"double"},{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"Age"},{"idx":1,"name":"Total_Purchase"},{"idx":2,"name":"Account_Manager"},{"idx":3,"name":"Years"},{"idx":4,"name":"Num_Sites"}]},"num_attrs":5}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}}],"type":"struct"},"tableIdentifier":null},{"name":"result","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"Age","nullable":true,"type":"double"},{"metadata":{},"name":"Total_Purchase","nullable":true,"type":"double"},{"metadata":{},"name":"Account_Manager","nullable":true,"type":"integer"},{"metadata":{},"name":"Years","nullable":true,"type":"double"},{"metadata":{},"name":"Num_Sites","nullable":true,"type":"double"},{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"Age"},{"idx":1,"name":"Total_Purchase"},{"idx":2,"name":"Account_Manager"},{"idx":3,"name":"Years"},{"idx":4,"name":"Num_Sites"}]},"num_attrs":5}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"rawPrediction","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"probability","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"prediction","nullable":false,"type":"double"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":"<span class=\"ansired\">IllegalArgumentException</span>: u&apos;Field &quot;features&quot; does not exist.&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">IllegalArgumentException</span>                  Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-284330860034174&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>result <span class=\"ansiyellow\">=</span> lr_model<span class=\"ansiyellow\">.</span>transform<span class=\"ansiyellow\">(</span>new_costumers<span class=\"ansiyellow\">[</span>features_col<span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/ml/base.py</span> in <span class=\"ansicyan\">transform</span><span class=\"ansiblue\">(self, dataset, params)</span>\n<span class=\"ansigreen\">    103</span>                 <span class=\"ansigreen\">return</span> self<span class=\"ansiyellow\">.</span>copy<span class=\"ansiyellow\">(</span>params<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>_transform<span class=\"ansiyellow\">(</span>dataset<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    104</span>             <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 105</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">return</span> self<span class=\"ansiyellow\">.</span>_transform<span class=\"ansiyellow\">(</span>dataset<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    106</span>         <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    107</span>             <span class=\"ansigreen\">raise</span> ValueError<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;Params must be a param map but got %s.&quot;</span> <span class=\"ansiyellow\">%</span> type<span class=\"ansiyellow\">(</span>params<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/ml/wrapper.py</span> in <span class=\"ansicyan\">_transform</span><span class=\"ansiblue\">(self, dataset)</span>\n<span class=\"ansigreen\">    279</span>     <span class=\"ansigreen\">def</span> _transform<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">,</span> dataset<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    280</span>         self<span class=\"ansiyellow\">.</span>_transfer_params_to_java<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 281</span><span class=\"ansiyellow\">         </span><span class=\"ansigreen\">return</span> DataFrame<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>_java_obj<span class=\"ansiyellow\">.</span>transform<span class=\"ansiyellow\">(</span>dataset<span class=\"ansiyellow\">.</span>_jdf<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> dataset<span class=\"ansiyellow\">.</span>sql_ctx<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    282</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    283</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1131</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1132</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1133</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1134</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1135</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     77</span>                 <span class=\"ansigreen\">raise</span> QueryExecutionException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     78</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;java.lang.IllegalArgumentException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 79</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">raise</span> IllegalArgumentException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     80</span>             <span class=\"ansigreen\">raise</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     81</span>     <span class=\"ansigreen\">return</span> deco<span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">IllegalArgumentException</span>: u&apos;Field &quot;features&quot; does not exist.&apos;</div>","workflows":[],"startTime":1515941416722,"submitTime":1515941416707,"finishTime":1515941416852,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e88a5ead-9993-407b-91d7-89b13366127c"},{"version":"CommandV1","origId":284330860034175,"guid":"a24a32aa-adad-4774-8653-16da725a009c","subtype":"command","commandType":"auto","position":19.0,"command":"result.show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+----+--------------+---------------+-----+---------+--------------------+--------------------+--------------------+----------+\n| Age|Total_Purchase|Account_Manager|Years|Num_Sites|            features|       rawPrediction|         probability|prediction|\n+----+--------------+---------------+-----+---------+--------------------+--------------------+--------------------+----------+\n|37.0|       9935.53|              1| 7.71|      8.0|[37.0,9935.53,1.0...|[2.72393548210563...|[0.93842433479488...|       0.0|\n|23.0|       7526.94|              1| 9.28|     15.0|[23.0,7526.94,1.0...|[-6.4735472165412...|[0.00154136056901...|       1.0|\n|65.0|         100.0|              1|  1.0|     15.0|[65.0,100.0,1.0,1...|[-3.4842141847001...|[0.02976473774736...|       1.0|\n|32.0|        6487.5|              0|  9.4|     14.0|[32.0,6487.5,0.0,...|[-5.2174185321551...|[0.00539207392263...|       1.0|\n|32.0|      13147.71|              1| 10.0|      8.0|[32.0,13147.71,1....|[1.42175720081680...|[0.80561374226495...|       0.0|\n|22.0|       8445.26|              1| 3.46|     14.0|[22.0,8445.26,1.0...|[-1.9293947581548...|[0.12681758637250...|       1.0|\n+----+--------------+---------------+-----+---------+--------------------+--------------------+--------------------+----------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1515941425825,"submitTime":1515941425812,"finishTime":1515941426199,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c9581e51-13ef-4748-b2f0-32ebedd96b63"},{"version":"CommandV1","origId":284330860034176,"guid":"b6c50fca-791f-4d12-ad2e-cf9f60896e04","subtype":"command","commandType":"auto","position":20.0,"command":"","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"03fb4b7a-cb56-4e0a-9847-1cef160eecb7"},{"version":"CommandV1","origId":3632859077492019,"guid":"7ca199a4-857a-4e05-a527-5b81b60a71ec","subtype":"command","commandType":"auto","position":1.0,"command":"%md # Logistic Regression Consulting Project","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1515937925394,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"nuid":"16abccc0-db0f-480e-9ca5-6b5a266d757d"},{"version":"CommandV1","origId":3632859077492020,"guid":"a34a170d-11df-46a3-801a-d0bb2b56349b","subtype":"command","commandType":"auto","position":2.0,"command":"%md ## Binary Customer Churn\n\nA marketing agency has many customers that use their service to produce ads for the client/customer websites. They've noticed that they have quite a bit of churn in clients. They basically randomly assign account managers right now, but want you to create a machine learning model that will help predict which customers will churn (stop buying their service) so that they can correctly assign the customers most at risk to churn an account manager. Luckily they have some historical data, can you help them out? Create a classification algorithm that will help classify whether or not a customer churned. Then the company can test this against incoming data for future customers to predict which customers will churn and assign them an account manager.\n\nThe data is saved as customer_churn.csv. Here are the fields and their definitions:\n\n    Name : Name of the latest contact at Company\n    Age: Customer Age\n    Total_Purchase: Total Ads Purchased\n    Account_Manager: Binary 0=No manager, 1= Account manager assigned\n    Years: Totaly Years as a customer\n    Num_sites: Number of websites that use the service.\n    Onboard_date: Date that the name of the latest contact was onboarded\n    Location: Client HQ Address\n    Company: Name of Client Company\n    \nOnce you've created the model and evaluated it, test out the model on some new data (you can think of this almost like a hold-out set) that your client has provided, saved under new_customers.csv. The client wants to know which customers are most likely to churn given this data (they don't have the label yet).","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1515937925509,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{"collapsed":true},"streamStates":{},"nuid":"2889178f-9378-44a2-94e0-19bedb80f7a3"},{"version":"CommandV1","origId":4060171435343782,"guid":"464d6d9e-f446-4687-abef-f2c8f23b6c33","subtype":"command","commandType":"auto","position":3.0,"command":"from pyspark.sql import SparkSession\nspark = SparkSession.builder.appName(\"Customer Chrurn\").getOrCreate()\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">ImportError</span>: cannot import name SparkSession","error":null,"workflows":[],"startTime":1515937963726,"submitTime":1515937925519,"finishTime":1515937963913,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"669ae9e7-5a79-48e9-98c2-58604442bb24"},{"version":"CommandV1","origId":4060171435343785,"guid":"813339a5-5b20-4cfb-8cb1-277efcc6dd43","subtype":"command","commandType":"auto","position":4.0,"command":"data = spark.read.format('csv').load('/FileStore/tables/customer_churn.csv', header=True, inferSchema=True)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"data","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"Names","nullable":true,"type":"string"},{"metadata":{},"name":"Age","nullable":true,"type":"double"},{"metadata":{},"name":"Total_Purchase","nullable":true,"type":"double"},{"metadata":{},"name":"Account_Manager","nullable":true,"type":"integer"},{"metadata":{},"name":"Years","nullable":true,"type":"double"},{"metadata":{},"name":"Num_Sites","nullable":true,"type":"double"},{"metadata":{},"name":"Onboard_date","nullable":true,"type":"timestamp"},{"metadata":{},"name":"Location","nullable":true,"type":"string"},{"metadata":{},"name":"Company","nullable":true,"type":"string"},{"metadata":{},"name":"Churn","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1515937964072,"submitTime":1515937925628,"finishTime":1515937969352,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d3483430-5260-403c-839e-8af67a52df64"},{"version":"CommandV1","origId":4060171435343786,"guid":"961a6de9-fc4d-4684-96fc-f75f4e74eb4f","subtype":"command","commandType":"auto","position":5.0,"command":"print data.count()\ndata.show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">900\n+-------------------+----+--------------+---------------+-----+---------+-------------------+--------------------+--------------------+-----+\n|              Names| Age|Total_Purchase|Account_Manager|Years|Num_Sites|       Onboard_date|            Location|             Company|Churn|\n+-------------------+----+--------------+---------------+-----+---------+-------------------+--------------------+--------------------+-----+\n|   Cameron Williams|42.0|       11066.8|              0| 7.22|      8.0|2013-08-30 07:00:40|10265 Elizabeth M...|          Harvey LLC|    1|\n|      Kevin Mueller|41.0|      11916.22|              0|  6.5|     11.0|2013-08-13 00:38:46|6157 Frank Garden...|          Wilson PLC|    1|\n|        Eric Lozano|38.0|      12884.75|              0| 6.67|     12.0|2016-06-29 06:20:07|1331 Keith Court ...|Miller, Johnson a...|    1|\n|      Phillip White|42.0|       8010.76|              0| 6.71|     10.0|2014-04-22 12:43:12|13120 Daniel Moun...|           Smith Inc|    1|\n|     Cynthia Norton|37.0|       9191.58|              0| 5.56|      9.0|2016-01-19 15:31:15|765 Tricia Row Ka...|          Love-Jones|    1|\n|   Jessica Williams|48.0|      10356.02|              0| 5.12|      8.0|2009-03-03 23:13:37|6187 Olson Mounta...|        Kelly-Warren|    1|\n|        Eric Butler|44.0|      11331.58|              1| 5.23|     11.0|2016-12-05 03:35:43|4846 Savannah Roa...|   Reynolds-Sheppard|    1|\n|      Zachary Walsh|32.0|       9885.12|              1| 6.92|      9.0|2006-03-09 14:50:20|25271 Roy Express...|          Singh-Cole|    1|\n|        Ashlee Carr|43.0|       14062.6|              1| 5.46|     11.0|2011-09-29 05:47:23|3725 Caroline Str...|           Lopez PLC|    1|\n|     Jennifer Lynch|40.0|       8066.94|              1| 7.11|     11.0|2006-03-28 15:42:45|363 Sandra Lodge ...|       Reed-Martinez|    1|\n|       Paula Harris|30.0|      11575.37|              1| 5.22|      8.0|2016-11-13 13:13:01|Unit 8120 Box 916...|Briggs, Lamb and ...|    1|\n|     Bruce Phillips|45.0|       8771.02|              1| 6.64|     11.0|2015-05-28 12:14:03|Unit 1895 Box 094...|    Figueroa-Maynard|    1|\n|       Craig Garner|45.0|       8988.67|              1| 4.84|     11.0|2011-02-16 08:10:47|897 Kelley Overpa...|     Abbott-Thompson|    1|\n|       Nicole Olson|40.0|       8283.32|              1|  5.1|     13.0|2012-11-22 05:35:03|11488 Weaver Cape...|Smith, Kim and Ma...|    1|\n|     Harold Griffin|41.0|       6569.87|              1|  4.3|     11.0|2015-03-28 02:13:44|1774 Peter Row Ap...|Snyder, Lee and M...|    1|\n|       James Wright|38.0|      10494.82|              1| 6.81|     12.0|2015-07-22 08:38:40|45408 David Path ...|      Sanders-Pierce|    1|\n|      Doris Wilkins|45.0|       8213.41|              1| 7.35|     11.0|2006-09-03 06:13:55|28216 Wright Moun...|Andrews, Adams an...|    1|\n|Katherine Carpenter|43.0|      11226.88|              0| 8.08|     12.0|2006-10-22 04:42:38|Unit 4948 Box 481...|Morgan, Phillips ...|    1|\n|     Lindsay Martin|53.0|       5515.09|              0| 6.85|      8.0|2015-10-07 00:27:10|69203 Crosby Divi...|      Villanueva LLC|    1|\n|        Kathy Curry|46.0|        8046.4|              1| 5.69|      8.0|2014-11-06 23:47:14|9569 Caldwell Cre...|Berry, Orr and Ca...|    1|\n+-------------------+----+--------------+---------------+-----+---------+-------------------+--------------------+--------------------+-----+\nonly showing top 20 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1515937969373,"submitTime":1515937925740,"finishTime":1515937970789,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"019809f3-d63e-400a-be4d-07f2a5a22a51"},{"version":"CommandV1","origId":4060171435343787,"guid":"a07f4a7e-1f29-4eff-8c1a-763197a34eb3","subtype":"command","commandType":"auto","position":6.0,"command":"data.printSchema()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- Names: string (nullable = true)\n |-- Age: double (nullable = true)\n |-- Total_Purchase: double (nullable = true)\n |-- Account_Manager: integer (nullable = true)\n |-- Years: double (nullable = true)\n |-- Num_Sites: double (nullable = true)\n |-- Onboard_date: timestamp (nullable = true)\n |-- Location: string (nullable = true)\n |-- Company: string (nullable = true)\n |-- Churn: integer (nullable = true)\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1515937970802,"submitTime":1515937925858,"finishTime":1515937970879,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"58f94d20-fc8c-430c-9431-fe67bd2c11f7"},{"version":"CommandV1","origId":4060171435343788,"guid":"51cb5d69-a15a-4057-b3ae-a64fb47a908a","subtype":"command","commandType":"auto","position":7.0,"command":"columns = data.columns\nfeatures_col = ['Age', 'Total_Purchase', 'Account_Manager', 'Years', 'Num_Sites']\nprint columns","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">[&apos;Names&apos;, &apos;Age&apos;, &apos;Total_Purchase&apos;, &apos;Account_Manager&apos;, &apos;Years&apos;, &apos;Num_Sites&apos;, &apos;Onboard_date&apos;, &apos;Location&apos;, &apos;Company&apos;, &apos;Churn&apos;]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1515937970889,"submitTime":1515937925966,"finishTime":1515937970967,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5f8a0357-3a4a-44f6-baba-4da3092bd927"},{"version":"CommandV1","origId":4060171435343789,"guid":"d026824c-96df-4d69-a3e2-67f46c9dc713","subtype":"command","commandType":"auto","position":8.0,"command":"\ndata = data.select(['Age', 'Total_Purchase', 'Account_Manager', 'Years', 'Num_Sites','Churn'])\ndata = data.na.drop()\nprint data.count()\ndata.show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">900\n+----+--------------+---------------+-----+---------+-----+\n| Age|Total_Purchase|Account_Manager|Years|Num_Sites|Churn|\n+----+--------------+---------------+-----+---------+-----+\n|42.0|       11066.8|              0| 7.22|      8.0|    1|\n|41.0|      11916.22|              0|  6.5|     11.0|    1|\n|38.0|      12884.75|              0| 6.67|     12.0|    1|\n|42.0|       8010.76|              0| 6.71|     10.0|    1|\n|37.0|       9191.58|              0| 5.56|      9.0|    1|\n|48.0|      10356.02|              0| 5.12|      8.0|    1|\n|44.0|      11331.58|              1| 5.23|     11.0|    1|\n|32.0|       9885.12|              1| 6.92|      9.0|    1|\n|43.0|       14062.6|              1| 5.46|     11.0|    1|\n|40.0|       8066.94|              1| 7.11|     11.0|    1|\n|30.0|      11575.37|              1| 5.22|      8.0|    1|\n|45.0|       8771.02|              1| 6.64|     11.0|    1|\n|45.0|       8988.67|              1| 4.84|     11.0|    1|\n|40.0|       8283.32|              1|  5.1|     13.0|    1|\n|41.0|       6569.87|              1|  4.3|     11.0|    1|\n|38.0|      10494.82|              1| 6.81|     12.0|    1|\n|45.0|       8213.41|              1| 7.35|     11.0|    1|\n|43.0|      11226.88|              0| 8.08|     12.0|    1|\n|53.0|       5515.09|              0| 6.85|      8.0|    1|\n|46.0|        8046.4|              1| 5.69|      8.0|    1|\n+----+--------------+---------------+-----+---------+-----+\nonly showing top 20 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"data","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"Age","nullable":true,"type":"double"},{"metadata":{},"name":"Total_Purchase","nullable":true,"type":"double"},{"metadata":{},"name":"Account_Manager","nullable":true,"type":"integer"},{"metadata":{},"name":"Years","nullable":true,"type":"double"},{"metadata":{},"name":"Num_Sites","nullable":true,"type":"double"},{"metadata":{},"name":"Churn","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;data_col&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-4060171435343789&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> data <span class=\"ansiyellow\">=</span> data<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;Age&apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&apos;Total_Purchase&apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&apos;Account_Manager&apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&apos;Years&apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&apos;Num_Sites&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;Churn&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 3</span><span class=\"ansiyellow\"> </span>data <span class=\"ansiyellow\">=</span> data_col<span class=\"ansiyellow\">.</span>na<span class=\"ansiyellow\">.</span>drop<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> <span class=\"ansigreen\">print</span> data<span class=\"ansiyellow\">.</span>count<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span> data<span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;data_col&apos; is not defined</div>","workflows":[],"startTime":1515938094656,"submitTime":1515938094645,"finishTime":1515938096404,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":true,"iPythonMetadata":null,"streamStates":{},"nuid":"49a1f5ba-dbde-4776-adbc-cb73cf3f524d"},{"version":"CommandV1","origId":4060171435343790,"guid":"157e6afc-8e39-40e1-9454-a7657405a348","subtype":"command","commandType":"auto","position":9.0,"command":"from pyspark.ml.classification import LogisticRegression\nfrom pyspark.ml.feature import VectorAssembler","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1515938102116,"submitTime":1515938102096,"finishTime":1515938102264,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8fa48ff6-0773-4e9d-a6c7-25c67e2ac97b"},{"version":"CommandV1","origId":4060171435343791,"guid":"c18865e0-3062-4dd1-abc8-d1345af49a55","subtype":"command","commandType":"auto","position":10.0,"command":"logReg = LogisticRegression(featuresCol='features', labelCol='Churn')\nlr_model = logReg.fit(data_train)\npredictions_and_labels = lr_model.evaluate(data_test)\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;BinaryLogisticRegressionSummary&apos; object has no attribute &apos;describe&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-4060171435343791&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      3</span> predictions_and_labels <span class=\"ansiyellow\">=</span> lr_model<span class=\"ansiyellow\">.</span>evaluate<span class=\"ansiyellow\">(</span>data_test<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 5</span><span class=\"ansiyellow\"> </span>predictions_and_labels<span class=\"ansiyellow\">.</span>describe<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;BinaryLogisticRegressionSummary&apos; object has no attribute &apos;describe&apos;</div>","workflows":[],"startTime":1515947990539,"submitTime":1515947990519,"finishTime":1515947992354,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"868aa491-72b5-4d0b-ba78-88814e11633c"},{"version":"CommandV1","origId":4060171435343792,"guid":"4771ade6-764c-4891-9a9f-a2ea6b51f140","subtype":"command","commandType":"auto","position":9.5,"command":"data_train, data_test = final_data.randomSplit([0.7, 0.3])\n\ndata_train.describe().show()\ndata_test.describe().show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">+-------+-------------------+\n|summary|              Churn|\n+-------+-------------------+\n|  count|                630|\n|   mean|0.15555555555555556|\n| stddev|0.36272146473378947|\n|    min|                  0|\n|    max|                  1|\n+-------+-------------------+\n\n+-------+-------------------+\n|summary|              Churn|\n+-------+-------------------+\n|  count|                270|\n|   mean| 0.1925925925925926|\n| stddev|0.39506803886832065|\n|    min|                  0|\n|    max|                  1|\n+-------+-------------------+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"data_train","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"Age"},{"idx":1,"name":"Total_Purchase"},{"idx":2,"name":"Account_Manager"},{"idx":3,"name":"Years"},{"idx":4,"name":"Num_Sites"}]},"num_attrs":5}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"Churn","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null},{"name":"data_test","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"Age"},{"idx":1,"name":"Total_Purchase"},{"idx":2,"name":"Account_Manager"},{"idx":3,"name":"Years"},{"idx":4,"name":"Num_Sites"}]},"num_attrs":5}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"Churn","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1515938263937,"submitTime":1515938263923,"finishTime":1515938266071,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":true,"iPythonMetadata":null,"streamStates":{},"nuid":"18ff89b0-36ae-4842-8ab5-c7f523b9efd3"},{"version":"CommandV1","origId":4060171435343794,"guid":"8dd9f322-f539-4b68-8c73-5e3943743eaf","subtype":"command","commandType":"auto","position":9.25,"command":"print features_col\n\nassembler = VectorAssembler(inputCols=features_col, outputCol='features')\noutput = assembler.transform(data)\n\nfinal_data = output.select(['features','Churn'])\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">[&apos;Age&apos;, &apos;Total_Purchase&apos;, &apos;Account_Manager&apos;, &apos;Years&apos;, &apos;Num_Sites&apos;]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"output","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"Age","nullable":true,"type":"double"},{"metadata":{},"name":"Total_Purchase","nullable":true,"type":"double"},{"metadata":{},"name":"Account_Manager","nullable":true,"type":"integer"},{"metadata":{},"name":"Years","nullable":true,"type":"double"},{"metadata":{},"name":"Num_Sites","nullable":true,"type":"double"},{"metadata":{},"name":"Churn","nullable":true,"type":"integer"},{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"Age"},{"idx":1,"name":"Total_Purchase"},{"idx":2,"name":"Account_Manager"},{"idx":3,"name":"Years"},{"idx":4,"name":"Num_Sites"}]},"num_attrs":5}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}}],"type":"struct"},"tableIdentifier":null},{"name":"final_data","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"Age"},{"idx":1,"name":"Total_Purchase"},{"idx":2,"name":"Account_Manager"},{"idx":3,"name":"Years"},{"idx":4,"name":"Num_Sites"}]},"num_attrs":5}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"Churn","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;VectorAssembler&apos; object has no attribute &apos;select&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-4060171435343794&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      3</span> assembler<span class=\"ansiyellow\">.</span>transform<span class=\"ansiyellow\">(</span>data<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 5</span><span class=\"ansiyellow\"> </span>final_data <span class=\"ansiyellow\">=</span> assembler<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;features&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;Churn&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;VectorAssembler&apos; object has no attribute &apos;select&apos;</div>","workflows":[],"startTime":1515938300240,"submitTime":1515938300227,"finishTime":1515938300418,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"jrandson@gmail.com","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b76d88bb-5a38-48c9-bbfb-9d93818bc734"}],"dashboards":[],"guid":"d23d2590-7e46-46b9-9c3e-1d2e3e760f01","globalVars":{},"iPythonMetadata":{"nbformat":4,"IPythonMetadata":{"anaconda-cloud":{},"kernelspec":{"display_name":"Python [conda root]","language":"python","name":"conda-root-py"},"language_info":{"mimetype":"text/x-python","name":"python","pygments_lexer":"ipython3","codemirror_mode":{"name":"ipython","version":3},"version":"3.5.3","nbconvert_exporter":"python","file_extension":".py"}}},"inputWidgets":{}}